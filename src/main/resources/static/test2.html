<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì•Œë¦¼ WebSocket í…ŒìŠ¤íŠ¸</title>
</head>
<body>
<h1>ì•Œë¦¼ WebSocket í…ŒìŠ¤íŠ¸</h1>
<input id="token" placeholder="JWT í† í° ì…ë ¥" style="width: 300px;">
<button onclick="connectSocket()">ì—°ê²°í•˜ê¸°</button>
<ul id="messages"></ul>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  let socket;

  function connectSocket() {
    const token = document.getElementById("token").value;
    if (!token) {
      alert("í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    // ì•Œë¦¼ ì„œë²„ í¬íŠ¸ì— ì—°ê²°
    socket = io("ws://localhost:9093", {
      query: { token: token },
      transports: ["websocket"]
    });

    socket.on("connect", () => {
      console.log("ì•Œë¦¼ ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");
      appendMessage("âœ… ì—°ê²° ì„±ê³µ");
    });

    socket.on("disconnect", () => {
      console.log("ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.");
      appendMessage("âŒ ì—°ê²° í•´ì œ");
    });

    socket.on("sendAlarm", (data) => {
      console.log("ì•Œë¦¼ ìˆ˜ì‹ :", data);
      appendMessage(`ğŸ“¬ ì•Œë¦¼ ë„ì°©: ${JSON.stringify(data)}`);
    });

    socket.on("connect_error", (error) => {
      console.error("ì—°ê²° ì˜¤ë¥˜:", error);
      appendMessage("âš ï¸ ì—°ê²° ì˜¤ë¥˜: " + error.message);
    });
  }

  function appendMessage(message) {
    const li = document.createElement("li");
    li.innerText = message;
    document.getElementById("messages").appendChild(li);
  }
</script>
</body>
</html>
